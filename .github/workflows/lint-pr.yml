name: Lint PR

on:
    pull_request:
        types: [opened, synchronize, reopened]

jobs:
    lint-pr:
        name: Lint Pull Request
        runs-on: ubuntu-latest

        steps:
            - name: Checkout code
              uses: actions/checkout@v4
              with:
                  fetch-depth: 0

            - name: Setup Node.js
              uses: actions/setup-node@v4
              with:
                  node-version: "20"
                  cache: "npm"

            - name: Install dependencies
              run: npm ci

            - name: Run ESLint on changed files
              run: |
                  git diff --name-only --diff-filter=d origin/${{ github.base_ref }}...HEAD | \
                  grep -E '\.(ts|tsx|js|jsx)$' | \
                  xargs -r npm run lint -- --max-warnings=0 || true

            - name: Comment PR with lint results
              uses: actions/github-script@v7
              if: always()
              with:
                  script: |
                      const output = `#### Lint Results ðŸŽ¨

                      Linting completed! Check the logs above for details.`;

                      github.rest.issues.createComment({
                        issue_number: context.issue.number,
                        owner: context.repo.owner,
                        repo: context.repo.repo,
                        body: output
                      })
